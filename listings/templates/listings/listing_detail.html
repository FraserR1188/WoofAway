{% extends "base.html" %}

{% block content %}
  <div class="container py-4">

    {# === Listing Image === #}
    {% if listing.image %}
      <div class="mb-4 text-center">
        <img 
          src="{{ listing.image.url }}" 
          alt="{{ listing.title }}" 
          class="img-fluid rounded" 
          style="max-height: 400px; object-fit: cover;"
        >
      </div>
    {% endif %}

    <h1>{{ listing.title }}</h1>
    <p><strong>Category:</strong> {{ listing.category }}</p>
    <p><strong>Location:</strong> {{ listing.location }}</p>
    <p><strong>Price per night:</strong> £{{ listing.price_per_night }}</p>
    <p>{{ listing.description }}</p>

    {# ← NEW: show host-defined max dogs #}
    <p><strong>Maximum dogs allowed:</strong> {{ listing.max_dogs }}</p>

    {# ← NEW: show dog policy #}
    {% if listing.dog_policy %}
      <p><strong>Dog Policy:</strong> {{ listing.dog_policy }}</p>
    {% endif %}

    {# ← NEW: show accessibility #}
    <p>
      <strong>Accessible?</strong>
      {% if listing.is_accessible %}
        <span class="text-success">Yes</span>
      {% else %}
        <span class="text-muted">No</span>
      {% endif %}
    </p>

    {# === Hosted By === #}
    <div class="mb-4">
      <strong>Hosted by:</strong>
      <a href="{% url 'accounts:profile_detail' listing.host.profile.pk %}">
        {{ listing.host.username }}
      </a>
    </div>

    <div class="mt-4">
      {# only show “Edit” to the logged-in host #}
      {% if user.is_authenticated and listing.host == user %}
        <a href="{% url 'listings:listing_edit' listing.pk %}" class="btn btn-outline-secondary me-2">
          Edit this listing
        </a>
      {% endif %}
      <a href="{% url 'listings:listing_list' %}" class="btn btn-outline-primary">
        Back to all listings
      </a>
    </div>

    {# ==== Reviews Section ==== #}
    <div class="mt-5">
      <h3>Reviews</h3>
      {% if listing.reviews.exists %}
        <ul class="list-group mb-4">
          {% for review in listing.reviews.all %}
            <li class="list-group-item">
              <!-- review content omitted for brevity -->
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No reviews yet. Be the first to leave one!</p>
      {% endif %}
    </div>

    {# ==== Booking CTA ==== #}
    <div class="mt-4">
      {% if user.is_authenticated %}
        {% if user != listing.host %}
          <a 
            href="{% url 'bookings:booking_create' listing.pk %}" 
            class="btn btn-primary mb-3"
          >
            Book Now
          </a>
        {% else %}
          <p class="text-muted">You’re the host of this listing.</p>
        {% endif %}
      {% else %}
        <a 
          href="{% url 'account_login' %}?next={% url 'bookings:booking_create' listing.pk %}" 
          class="btn btn-primary mb-3"
        >
          Login to Book
        </a>
      {% endif %}
    </div>

  </div>
{% endblock %}
